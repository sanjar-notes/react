"use strict";(self.webpackChunkreactjs_notes_docu=self.webpackChunkreactjs_notes_docu||[]).push([[2870],{9613:(e,t,n)=>{n.d(t,{Zo:()=>l,kt:()=>m});var i=n(9496);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=i.createContext({}),u=function(e){var t=i.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},l=function(e){var t=u(e.components);return i.createElement(c.Provider,{value:t},e.children)},f="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),f=u(n),d=a,m=f["".concat(c,".").concat(d)]||f[d]||p[d]||r;return n?i.createElement(m,o(o({ref:t},l),{},{components:n})):i.createElement(m,o({ref:t},l))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[f]="string"==typeof e?e:a,o[1]=s;for(var u=2;u<r;u++)o[u]=n[u];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}d.displayName="MDXCreateElement"},7738:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>u});var i=n(1163),a=(n(9496),n(9613));const r={},o="114. useEffect cleanup function",s={unversionedId:"home/resource_itineraries/React_the_complete_guide/side-effects,_reducers,_contextAPI/useEffect_cleanup_function",id:"home/resource_itineraries/React_the_complete_guide/side-effects,_reducers,_contextAPI/useEffect_cleanup_function",title:"114. useEffect cleanup function",description:"Created Tuesday 08 March 2022",source:"@site/docs/home/4_resource_itineraries/2_React_the_complete_guide/10_side-effects,_reducers,_contextAPI/114_useEffect_cleanup_function.md",sourceDirName:"home/4_resource_itineraries/2_React_the_complete_guide/10_side-effects,_reducers,_contextAPI",slug:"/home/resource_itineraries/React_the_complete_guide/side-effects,_reducers,_contextAPI/useEffect_cleanup_function",permalink:"/docs/home/resource_itineraries/React_the_complete_guide/side-effects,_reducers,_contextAPI/useEffect_cleanup_function",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/home/4_resource_itineraries/2_React_the_complete_guide/10_side-effects,_reducers,_contextAPI/114_useEffect_cleanup_function.md",tags:[],version:"current",sidebarPosition:114,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"110. useEffect hook",permalink:"/docs/home/resource_itineraries/React_the_complete_guide/side-effects,_reducers,_contextAPI/useEffect_hook"},next:{title:"117. useReducer hook",permalink:"/docs/home/resource_itineraries/React_the_complete_guide/side-effects,_reducers,_contextAPI/useReducer_hook"}},c={},u=[{value:"Why",id:"why",level:3},{value:"How",id:"how",level:3},{value:"What",id:"what",level:3},{value:"Example of cleanup function",id:"example-of-cleanup-function",level:4},{value:"useEffect is directly related to component lifecycle phases -  this is key to understanding when to use useEffect",id:"useeffect-is-directly-related-to-component-lifecycle-phases----this-is-key-to-understanding-when-to-use-useeffect",level:6},{value:"Class components and useEffect",id:"class-components-and-useeffect",level:6}],l={toc:u},f="wrapper";function p(e){let{components:t,...r}=e;return(0,a.kt)(f,(0,i.Z)({},l,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"114-useeffect-cleanup-function"},"114. useEffect cleanup function"),(0,a.kt)("p",null,"Created Tuesday 08 March 2022"),(0,a.kt)("ul",{className:"contains-task-list"},(0,a.kt)("li",{parentName:"ul",className:"task-list-item"},(0,a.kt)("input",{parentName:"li",type:"checkbox",checked:!0,disabled:!0})," ","in vault")),(0,a.kt)("h3",{id:"why"},"Why"),(0,a.kt)("p",null,"Situation: The useEffect function may create eventListeners, or timeouts. Of course, we want only the latest ones, to avoid a cascading effect from old eventListeners, timeouts."),(0,a.kt)("p",null,"To do this 'cleanup', some cleanup code can be associated with ",(0,a.kt)("inlineCode",{parentName:"p"},"useEffect"),", that runs ",(0,a.kt)("strong",{parentName:"p"},"before")," every ",(0,a.kt)("inlineCode",{parentName:"p"},"useEffect")," function call, except the first execution (after 1st render)."),(0,a.kt)("p",null,'This "cleanup" function can be specified as a callback from the function in ',(0,a.kt)("inlineCode",{parentName:"p"},"useEffect"),"."),(0,a.kt)("h3",{id:"how"},"How"),(0,a.kt)("p",null,"The cleanup function is run:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"After each ",(0,a.kt)("inlineCode",{parentName:"li"},"useEffect")," function execution."),(0,a.kt)("li",{parentName:"ol"},"Except the first ",(0,a.kt)("inlineCode",{parentName:"li"},"useEffect")," function execution. Here, the cleanup is not run before."),(0,a.kt)("li",{parentName:"ol"},"After the component has been unmounted from the DOM.")),(0,a.kt)("p",null,"So for ",(0,a.kt)("inlineCode",{parentName:"p"},"n")," re-renders, the:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"useEffect")," runs 1 (on first render) + ",(0,a.kt)("inlineCode",{parentName:"li"},"n")," times."),(0,a.kt)("li",{parentName:"ul"},"The cleanup runs ",(0,a.kt)("inlineCode",{parentName:"li"},"n")," + 1 (1 after unmount) times.")),(0,a.kt)("h3",{id:"what"},"What"),(0,a.kt)("p",null,"The cleanup function is meant to just have logic to avoid a cascading effect of the side-effect, as pointed out earlier."),(0,a.kt)("h4",{id:"example-of-cleanup-function"},"Example of cleanup function"),(0,a.kt)("p",null,"Suppose we have a text ",(0,a.kt)("inlineCode",{parentName:"p"},"input")," field, and we wish to check if the text exists in the backend or not. We will use ",(0,a.kt)("inlineCode",{parentName:"p"},"useEffect"),', because sending an HTTP request is a "side-effect". This is functionally OK. But if we do this on every ',(0,a.kt)("inlineCode",{parentName:"p"},"onChange")," of the field, it will be a lot of backend requests."),(0,a.kt)("p",null,"To avoid this, we can actually wait for some time after the user has stopped (finished) typing in the text field. So we use a ",(0,a.kt)("inlineCode",{parentName:"p"},"setTimeout")," in the ",(0,a.kt)("inlineCode",{parentName:"p"},"onChange")," function. This will create a timeout before sending the HTTP request."),(0,a.kt)("p",null,"But again, as the ",(0,a.kt)("inlineCode",{parentName:"p"},"setTimeout")," is set for each keystroke, but never removed, we'll have a cascading (repeating) effect from the enqueued ",(0,a.kt)("inlineCode",{parentName:"p"},"setTimeout"),"s. The solution is to remove the timeouts after each render, and set a new Timeout. This is perfect for the ",(0,a.kt)("inlineCode",{parentName:"p"},"useEffect"),", as the cleanup is run before the ",(0,a.kt)("inlineCode",{parentName:"p"},"useEffect")," function runs. The code would look something like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},"import {useEffect} from 'react';\n\nfunction MyComponent() {\n    ...\n    useEffect(() => {\n        const timeoutVar = setTimeout(\n            () => {\n                ... // check HTTP request and validate\n            };\n\n        return (() => { // cleanup function\n            clearTimeout(timeOutVar);\n        })\n            , 400);\n    }, [enteredField]);\n    ...\n};\n")),(0,a.kt)("p",null,"See this\n",(0,a.kt)("img",{src:n(3462).Z,width:"882",height:"692"}),"\nHere the timeouts will be set and unset when the user is typing, and finally one will be run if the user stops typing. This reduces network calls, and when they have typed successfully, a request is sent."),(0,a.kt)("p",null,"This way of validating typed input is called \"de-bouncing\". An example where this is used - GitHub new repo name does not exist tick mark, Gmail new username 'taken' validation."),(0,a.kt)("h6",{id:"useeffect-is-directly-related-to-component-lifecycle-phases----this-is-key-to-understanding-when-to-use-useeffect"},"useEffect is directly related to component lifecycle phases -  this is key to understanding when to use useEffect"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"useEffect")," is a way to run code w.r.t the life-cycle phases, which includes things like:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Run code after each render, by passing no dependency array."),(0,a.kt)("li",{parentName:"ul"},"Run code after before component is updated, i.e. using the cleanup function.")))),(0,a.kt)("h6",{id:"class-components-and-useeffect"},"Class components and useEffect"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"useEffect")," is essentially an API that's equivalent to the slightly imperative way to handle code that runs w.r.t lifecycle phases, as done in class components."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"useEffect")," made it difficult for the developer to make incoherent lifecycle code, resulting in bugs. Thus, it made development easier by removing the 'bad' possibilities which were possible due to imperative access to lifecycle functions. FIXME: really, is this true?")))}p.isMDXComponent=!0},3462:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/114_useEffect_cleanup_function-image-1-dd0c5d6245601e4abd13021706593aff.gif"}}]);