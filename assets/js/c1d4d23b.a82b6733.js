"use strict";(self.webpackChunkreactjs_notes_docu=self.webpackChunkreactjs_notes_docu||[]).push([[3710],{9613:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var o=n(9496);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),u=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return o.createElement(l.Provider,{value:t},e.children)},h="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),h=u(n),d=a,m=h["".concat(l,".").concat(d)]||h[d]||p[d]||r;return n?o.createElement(m,i(i({ref:t},c),{},{components:n})):o.createElement(m,i({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[h]="string"==typeof e?e:a,i[1]=s;for(var u=2;u<r;u++)i[u]=n[u];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},7360:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>u});var o=n(1163),a=(n(9496),n(9613));const r={},i="312. Persisting login state",s={unversionedId:"home/resource_itineraries/React_the_complete_guide/Adding_authentication_to_React_apps/Persisting login state",id:"home/resource_itineraries/React_the_complete_guide/Adding_authentication_to_React_apps/Persisting login state",title:"312. Persisting login state",description:"Created Sunday 27 November 2022",source:"@site/docs/home/4_resource_itineraries/2_React_the_complete_guide/22_Adding_authentication_to_React_apps/312. Persisting login state.md",sourceDirName:"home/4_resource_itineraries/2_React_the_complete_guide/22_Adding_authentication_to_React_apps",slug:"/home/resource_itineraries/React_the_complete_guide/Adding_authentication_to_React_apps/Persisting login state",permalink:"/reactjs-notes/docs/home/resource_itineraries/React_the_complete_guide/Adding_authentication_to_React_apps/Persisting login state",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/home/4_resource_itineraries/2_React_the_complete_guide/22_Adding_authentication_to_React_apps/312. Persisting login state.md",tags:[],version:"current",sidebarPosition:312,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"311. Protected pages",permalink:"/reactjs-notes/docs/home/resource_itineraries/React_the_complete_guide/Adding_authentication_to_React_apps/Protected_pages"},next:{title:"313. Auto logout",permalink:"/reactjs-notes/docs/home/resource_itineraries/React_the_complete_guide/Adding_authentication_to_React_apps/Auto-logout"}},l={},u=[{value:"Why",id:"why",level:2},{value:"How",id:"how",level:2},{value:"What",id:"what",level:2},{value:"Demo",id:"demo",level:2}],c={toc:u},h="wrapper";function p(e){let{components:t,...n}=e;return(0,a.kt)(h,(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"312-persisting-login-state"},"312. Persisting login state"),(0,a.kt)("p",null,"Created Sunday 27 November 2022"),(0,a.kt)("h2",{id:"why"},"Why"),(0,a.kt)("p",null,"It's a major hassle to log in to a website every time one visits. The problem only becomes worse because most applications today are web applications."),(0,a.kt)("p",null,"It would be great if the user just had to log in once, and all subsequent visits (even when the browser was re-opened) would just store this login state."),(0,a.kt)("h2",{id:"how"},"How"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"During a visit, auth tokens are stored on the client side. "),(0,a.kt)("li",{parentName:"ul"},"Also, they don't change on every visit, depends on the web app though.")),(0,a.kt)("p",null,"These two facts imply that saving the auth token (to disk - i.e. browser controller storage) would not be such a security problem, since an attacker can steal the auth tokens during a visit anyway, if they have direct access to the computer."),(0,a.kt)("p",null,"Some safety measures:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"We can make this more secure(? is it \"more\") by having the browser encrypt the auth tokens before saving them to disk, so no other local app on the user's device can use them. They'll only be available inside the browser. This doesn't concern the web app developer, though."),(0,a.kt)("li",{parentName:"ol"},"Of course, one can enforce a time limit like 20 days, when the user would have to log in manually. This time limit could be baked into the auth token itself, so that the server doesn't have to store anything.")),(0,a.kt)("p",null,"The ",(0,a.kt)("strong",{parentName:"p"},"sign-up/log-in/use flow")," is something like this:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"The user signs up/ logs in - we persist the received auth token and the expiry datetime (if any). We also save the token in web app's RAM (e.g. Redux store)."),(0,a.kt)("li",{parentName:"ol"},"For all subsequent requests, we send the auth token from the Redux store. The server responds. Three cases are possible here:",(0,a.kt)("ol",{parentName:"li"},(0,a.kt)("li",{parentName:"ol"},"The token remains the same - the server just sends the same token back or an indicator saying it has not changed. We do nothing, just continue."),(0,a.kt)("li",{parentName:"ol"},"The token has changed - the server will provide the new token in the response. We update the token stored in disk (",(0,a.kt)("inlineCode",{parentName:"li"},"localStorage"),"). We also update the Redux store."),(0,a.kt)("li",{parentName:"ol"},"The server responds with indication to manually log in, for example by sending an empty token. In this case we reset both the ",(0,a.kt)("inlineCode",{parentName:"li"},"localStorage")," and Redux and start the flow from the beginning."))),(0,a.kt)("li",{parentName:"ol"},"The user continues using the app, then closes the browser/tab or refreshes."),(0,a.kt)("li",{parentName:"ol"},"When the user visits the site again, we see if the persisted token has:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Not expired - we initialize the token from ",(0,a.kt)("inlineCode",{parentName:"li"},"localStorage")," to the Redux store. And the flow starts again."),(0,a.kt)("li",{parentName:"ul"},"Expired - we remove the token from ",(0,a.kt)("inlineCode",{parentName:"li"},"localStorage"),". When the app loads, Redux is not able to find any stored token, so the flow starts again. But this time, the user needs to log in manually.")))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Logout flow")," - Just remove/clear the token from ",(0,a.kt)("inlineCode",{parentName:"p"},"localStorage"),'. Show a timed "You\'ve logged out toast/notification" if you want.'),(0,a.kt)("p",null,"Note - the expiry time of a token is somewhat ambiguous:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"It could mean ",(0,a.kt)("em",{parentName:"li"},"when")," the token will change ",(0,a.kt)("em",{parentName:"li"},"next")," (and the server won't send the new token without manual login)."),(0,a.kt)("li",{parentName:"ol"},"Or. It could mean that the token can change between requests, but the expiry refers to the need for manual login.\nHowever, this doesn't concern the web app developer. Just assume the token can change frequently without need for login, both cases are handled.")),(0,a.kt)("h2",{id:"what"},"What"),(0,a.kt)("p",null,"One can simply use ",(0,a.kt)("inlineCode",{parentName:"p"},"localStorage"),", or some other storage.\nNote - tokens kept in ",(0,a.kt)("inlineCode",{parentName:"p"},"localStorage")," are vulnerable to XSS attacks. But XSS attacks are a huge problem anyway for a web app."),(0,a.kt)("h2",{id:"demo"},"Demo"),(0,a.kt)("p",null,"We are going to use the ",(0,a.kt)("inlineCode",{parentName:"p"},"localStorage")," to save the auth token."))}p.isMDXComponent=!0}}]);