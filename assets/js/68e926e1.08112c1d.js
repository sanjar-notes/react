"use strict";(self.webpackChunkreactjs_notes_docu=self.webpackChunkreactjs_notes_docu||[]).push([[3088],{9613:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>h});var n=a(9496);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),c=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=c(a),m=r,h=u["".concat(s,".").concat(m)]||u[m]||d[m]||i;return a?n.createElement(h,o(o({ref:t},p),{},{components:a})):n.createElement(h,o({ref:t},p))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:r,o[1]=l;for(var c=2;c<i;c++)o[c]=a[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},6832:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var n=a(1163),r=(a(9496),a(9613));const i={},o="399. SSG for dynamic routes- getStaticPaths",l={unversionedId:"home/resource_itineraries/React_the_complete_guide/Intro_to_Next_js/Prerendering_and_related_constructs/SSG_for_dynamic_routes_getStaticPaths",id:"home/resource_itineraries/React_the_complete_guide/Intro_to_Next_js/Prerendering_and_related_constructs/SSG_for_dynamic_routes_getStaticPaths",title:"399. SSG for dynamic routes- getStaticPaths",description:"Created Sunday 18 December 2022",source:"@site/docs/home/4_resource_itineraries/2_React_the_complete_guide/23_Intro_to_Next_js/6_Prerendering_and_related_constructs/339_SSG_for_dynamic_routes_getStaticPaths.md",sourceDirName:"home/4_resource_itineraries/2_React_the_complete_guide/23_Intro_to_Next_js/6_Prerendering_and_related_constructs",slug:"/home/resource_itineraries/React_the_complete_guide/Intro_to_Next_js/Prerendering_and_related_constructs/SSG_for_dynamic_routes_getStaticPaths",permalink:"/docs/home/resource_itineraries/React_the_complete_guide/Intro_to_Next_js/Prerendering_and_related_constructs/SSG_for_dynamic_routes_getStaticPaths",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/home/4_resource_itineraries/2_React_the_complete_guide/23_Intro_to_Next_js/6_Prerendering_and_related_constructs/339_SSG_for_dynamic_routes_getStaticPaths.md",tags:[],version:"current",sidebarPosition:339,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"338. More about SSR with getServerSideProps",permalink:"/docs/home/resource_itineraries/React_the_complete_guide/Intro_to_Next_js/Prerendering_and_related_constructs/More_about_SSR_with_getServerSideProps"},next:{title:"341. Introducing API Routes",permalink:"/docs/home/resource_itineraries/React_the_complete_guide/Intro_to_Next_js/API_Routes/Introducing_API_Routes"}},s={},c=[{value:"Why (situation)",id:"why-situation",level:2},{value:"How",id:"how",level:2},{value:"What",id:"what",level:2},{value:"Parameters",id:"parameters",level:3},{value:"Return value",id:"return-value",level:3},{value:"Fallback pages",id:"fallback-pages",level:3},{value:"Updating pages generated due to by <code>fallback: true</code> and <code>fallback: &#39;blocking&#39;</code>",id:"updating-pages-generated-due-to-by-fallback-true-and-fallback-blocking",level:2}],p={toc:c},u="wrapper";function d(e){let{components:t,...a}=e;return(0,r.kt)(u,(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"399-ssg-for-dynamic-routes--getstaticpaths"},"399. SSG for dynamic routes- ",(0,r.kt)("inlineCode",{parentName:"h1"},"getStaticPaths")),(0,r.kt)("p",null,"Created Sunday 18 December 2022"),(0,r.kt)("h2",{id:"why-situation"},"Why (situation)"),(0,r.kt)("p",null,"We have a page with dynamic routes. But it's not that high velocity or variable data (for example the dynamic routes are movie names, and not something like social media post ID) "),(0,r.kt)("p",null,"Some of these routes are popular. So, we wish to build pages them before hand, i.e. we want to do SSG."),(0,r.kt)("p",null,"Also, we have a the list of popular movie names."),(0,r.kt)("p",null,"There are several problems:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Technically, issue with ",(0,r.kt)("inlineCode",{parentName:"li"},"getStaticProps")," is that it runs only once, for a route."),(0,r.kt)("li",{parentName:"ol"},"We may not have \"all\" possible movie names. But we also don't want to do SSR (assume we don't have a very capable server).")),(0,r.kt)("p",null,"So, SSG for dynamic routes. Also, we may not have a complete list of possible routes during build time."),(0,r.kt)("h2",{id:"how"},"How"),(0,r.kt)("p",null,"The solution is to run ",(0,r.kt)("inlineCode",{parentName:"p"},"getStaticProps")," for all the dynamic routes that we want, for the given page."),(0,r.kt)("p",null,"For problem ","#","2, we could run ",(0,r.kt)("inlineCode",{parentName:"p"},"getStaticProps"),' on "request time" for movie names that weren\'t on our list, and store (like other SSG pages) the generated pages. So kind of a "memoized one time SSR".'),(0,r.kt)("h2",{id:"what"},"What"),(0,r.kt)("p",null,"Next.js solves this problem, of SSG with dynamic routes, with the ",(0,r.kt)("inlineCode",{parentName:"p"},"getStaticPaths")," function."),(0,r.kt)("p",null,"Similar to ",(0,r.kt)("inlineCode",{parentName:"p"},"getStaticProps")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"getServerSideProps"),", it should be added (",(0,r.kt)("inlineCode",{parentName:"p"},"expor"),"ted normally, technically speaking) page file."),(0,r.kt)("p",null,"Without ",(0,r.kt)("inlineCode",{parentName:"p"},"getStaticPaths"),", the idea of a route param inside ",(0,r.kt)("inlineCode",{parentName:"p"},"getStaticProps")," is moot, since it is run on build time, when no request exists."),(0,r.kt)("p",null,"With ",(0,r.kt)("inlineCode",{parentName:"p"},"getStaticPaths"),', the "context" parameter in ',(0,r.kt)("inlineCode",{parentName:"p"},"getStaticProps")," has a ",(0,r.kt)("inlineCode",{parentName:"p"},"param")," attribute which is an object containing the dynamic route params. ",(0,r.kt)("strong",{parentName:"p"},"Note"),", this is not an array."),(0,r.kt)("h3",{id:"parameters"},"Parameters"),(0,r.kt)("p",null,'First one called "context". Contains the dynamic route param - again, an object exactly like ',(0,r.kt)("inlineCode",{parentName:"p"},"getServerSideProps"),'\'s "context.param".'),(0,r.kt)("h3",{id:"return-value"},"Return value"),(0,r.kt)("p",null,"The function must return an object with two things:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"paths")," - an array with objects of shape ",(0,r.kt)("inlineCode",{parentName:"li"},"{ params: {paramOne: string, paramSecond: string, ... } }"),".  Same as ",(0,r.kt)("inlineCode",{parentName:"li"},"getServerSideProps"),'\'s "context.param".'),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"fallback")," - boolean or the string ",(0,r.kt)("inlineCode",{parentName:"li"},"blocking"),".",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"false")," - indicates that all paths have been listed. Returns 404 page for unlisted paths."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"true")," - indicates that not all possible route params paths have been listed. On requests with a ",(0,r.kt)("em",{parentName:"li"},"new")," unlisted path, Next.js responds to the client with a 'fallback' UI, but continues processing on the server - ",(0,r.kt)("inlineCode",{parentName:"li"},"getStaticProps")," will be run with the requested route, cache the generated page and return it to the client, who will now see a fully loaded page. ",(0,r.kt)("strong",{parentName:"li"},"In short, it's like ",(0,r.kt)("inlineCode",{parentName:"strong"},"fallback.true")," + new page returned"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"'blocking'")," - exactly like ",(0,r.kt)("inlineCode",{parentName:"li"},"true"),", but instead of immediately returning a fallback page, responds only when the new unlisted route page is ready.")))),(0,r.kt)("p",null,"Note - in case of ",(0,r.kt)("inlineCode",{parentName:"p"},"fallback: 'blocking'"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"getStaticProps")," runs once and the page component runs once. But in case of ",(0,r.kt)("inlineCode",{parentName:"p"},"fallback: true"),", the component run once to generate the fallback UI (which is returned immediately to the client), then ",(0,r.kt)("inlineCode",{parentName:"p"},"getStaticProps")," runs and then again the page component runs (this time with props)."),(0,r.kt)("p",null,"Code examples - ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/exemplar-codes/nextjs-first-realistic-tutorial/commit/57e80c86440f6345c43c51c3d524977fea72be6a"},(0,r.kt)("inlineCode",{parentName:"a"},"fallback:false")),", ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/exemplar-codes/nextjs-first-realistic-tutorial/commit/3a8211464d693382f8f3214cd0b0655f75a00032"},(0,r.kt)("inlineCode",{parentName:"a"},"fallback:true")),", ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/exemplar-codes/nextjs-first-realistic-tutorial/commit/91630a3607d47db45c7d3f37aaa649925e1e8806"},(0,r.kt)("inlineCode",{parentName:"a"},"fallback:'blocking'"))),(0,r.kt)("h3",{id:"fallback-pages"},"Fallback pages"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The fallback page (used when ",(0,r.kt)("inlineCode",{parentName:"li"},"getStaticPaths")," returns ",(0,r.kt)("inlineCode",{parentName:"li"},"fallback:true"),") is specified inside the page component itself."),(0,r.kt)("li",{parentName:"ul"},"To check if the page component is being run to generate fallback page, use ",(0,r.kt)("inlineCode",{parentName:"li"},"useRouter().isFallback"),", which is a boolean."),(0,r.kt)("li",{parentName:"ul"},"If ",(0,r.kt)("inlineCode",{parentName:"li"},"isFallback")," is true, the UI returned by the page component is the fallback page.")),(0,r.kt)("p",null,"Example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"export default function MyPage() {\n  const router = useRouter();\n  if(router.isFallback) {\n    return <MyLoadingSpinnerFallbackUI />; \n  }\n\n  // page code\n  \n  return <...>; // return page UI as usual\n}\n\nexport function getStaticProps() {\n  //\n  return ...;\n}\n\nexport function getStaticPaths() {\n  return { paths: [], fallback: true}; // or 'blocking'\n}\n")),(0,r.kt)("p",null,"Note: If ",(0,r.kt)("inlineCode",{parentName:"p"},"isFallback")," is true, the page's props will be empty (as ",(0,r.kt)("inlineCode",{parentName:"p"},"getStaticProps")," has been skipped to generate the UI). It will be available in the second run of the component, of course."),(0,r.kt)("h2",{id:"updating-pages-generated-due-to-by-fallback-true-and-fallback-blocking"},"Updating pages generated due to by ",(0,r.kt)("inlineCode",{parentName:"h2"},"fallback: true")," and ",(0,r.kt)("inlineCode",{parentName:"h2"},"fallback: 'blocking'")),(0,r.kt)("p",null,"Both options are still a part of SSG, and hence they don't automatically update the pages they may have generated for unlisted routes."),(0,r.kt)("p",null,"To do so, use ISR, no special code required. i.e. in addition to returning ",(0,r.kt)("inlineCode",{parentName:"p"},"fallback")," from ",(0,r.kt)("inlineCode",{parentName:"p"},"getStaticPaths"),", also return ",(0,r.kt)("inlineCode",{parentName:"p"},"revalidate")," from ",(0,r.kt)("inlineCode",{parentName:"p"},"getStaticProps"),"."),(0,r.kt)("p",null,"Note: In any scenario, ",(0,r.kt)("inlineCode",{parentName:"p"},"getStaticPaths")," runs only once - when the server is initialized. (FIXME, just confirm once)"))}d.isMDXComponent=!0}}]);