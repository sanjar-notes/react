"use strict";(self.webpackChunkreactjs_notes_docu=self.webpackChunkreactjs_notes_docu||[]).push([[1848],{9613:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>g});var o=n(9496);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=o.createContext({}),c=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=c(e.components);return o.createElement(s.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(n),m=r,g=p["".concat(s,".").concat(m)]||p[m]||d[m]||a;return n?o.createElement(g,i(i({ref:t},u),{},{components:n})):o.createElement(g,i({ref:t},u))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:r,i[1]=l;for(var c=2;c<a;c++)i[c]=n[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},9611:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>c});var o=n(1163),r=(n(9496),n(9613));const a={},i="342. Working with MongoDB",l={unversionedId:"home/resource_itineraries/React_the_complete_guide/Intro_to_Next_js/API_Routes/Working_with_MongoDB",id:"home/resource_itineraries/React_the_complete_guide/Intro_to_Next_js/API_Routes/Working_with_MongoDB",title:"342. Working with MongoDB",description:"Created Friday 23 December 2022",source:"@site/docs/home/4_resource_itineraries/2_React_the_complete_guide/23_Intro_to_Next_js/7_API_Routes/342_Working_with_MongoDB.md",sourceDirName:"home/4_resource_itineraries/2_React_the_complete_guide/23_Intro_to_Next_js/7_API_Routes",slug:"/home/resource_itineraries/React_the_complete_guide/Intro_to_Next_js/API_Routes/Working_with_MongoDB",permalink:"/docs/home/resource_itineraries/React_the_complete_guide/Intro_to_Next_js/API_Routes/Working_with_MongoDB",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/home/4_resource_itineraries/2_React_the_complete_guide/23_Intro_to_Next_js/7_API_Routes/342_Working_with_MongoDB.md",tags:[],version:"current",sidebarPosition:342,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"341. Introducing API Routes",permalink:"/docs/home/resource_itineraries/React_the_complete_guide/Intro_to_Next_js/API_Routes/Introducing_API_Routes"},next:{title:"343. Continuing with the project",permalink:"/docs/home/resource_itineraries/React_the_complete_guide/Intro_to_Next_js/API_Routes/Continuing_with_the_project"}},s={},c=[{value:"Mongo DB notes",id:"mongo-db-notes",level:2},{value:"1. <strong>Connect to the server</strong>",id:"1-connect-to-the-server",level:3},{value:"2. <strong>Access a collection (aka table)</strong>.",id:"2-access-a-collection-aka-table",level:3},{value:"3. Query/mutate a collection",id:"3-querymutate-a-collection",level:3},{value:"4. Closing the connection",id:"4-closing-the-connection",level:3}],u={toc:c},p="wrapper";function d(e){let{components:t,...n}=e;return(0,r.kt)(p,(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"342-working-with-mongodb"},"342. Working with MongoDB"),(0,r.kt)("p",null,"Created Friday 23 December 2022"),(0,r.kt)("p",null,"We'll use a MongoDB database. Instead of setting up a local instance, we'll use the MongoDB Atlas product, where we can set up a DB in the cloud and it offers a free tier that's sufficient for our use case here. "),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Create an account"),(0,r.kt)("li",{parentName:"ol"},"Create a project if none exist."),(0,r.kt)("li",{parentName:"ol"},"Create a database - select free plan, add a DB user, add current IP address if prompted."),(0,r.kt)("li",{parentName:"ol"},'Prepare to connect - install the Node package "mongodb" in the project. On the instance page (mongodb.com), click "Connect" and copy the string it presents. Also, make sure the current IP address has been added to the list.'),(0,r.kt)("li",{parentName:"ol"},"Connect - In the API route file, import the ",(0,r.kt)("inlineCode",{parentName:"li"},"MongoClient"),' function from the "mongo" package, one of many functions.')),(0,r.kt)("h2",{id:"mongo-db-notes"},"Mongo DB notes"),(0,r.kt)("h3",{id:"1-connect-to-the-server"},"1. ",(0,r.kt)("strong",{parentName:"h3"},"Connect to the server")),(0,r.kt)("p",null,"First copy the skeleton link provided by MongoDB site/local database URL. We need to pass in username password separated by colon."),(0,r.kt)("p",null,"Connecting is an async operation, obviously."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import { MongoClient } from \'mongo\';\n\nasync function handler() {\n    const username = "myUserName1233", password = "zyfsPassworrd";\n    const client = await MongoClient.connect(`mongodb+srv://${username}:${password}@cluster0.somethinxyz.mongodb.net`);\n    const db = client.db(); // sync op\n}\n')),(0,r.kt)("h3",{id:"2-access-a-collection-aka-table"},"2. ",(0,r.kt)("strong",{parentName:"h3"},"Access a collection (aka table)"),"."),(0,r.kt)("p",null,"It's a synchronous operation. The collection will be created if it does not exist."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'// assuming db variable from above\nconst meetupCollection = db.collection("meetups");\n')),(0,r.kt)("h3",{id:"3-querymutate-a-collection"},"3. Query/mutate a collection"),(0,r.kt)("p",null,"All query/mutate ops are async, and may fail."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const allRows = await myCollection.find().toArray(); // get all rows, with all their entities\n\nconst allRowsJustNames = await myCollection.find({}, {name: 1}).toArray(); // get all rows, only with 'name' entity\n\nconst selectedRow = await myCollection.find({}, {_id: value_here}); // get row with _id of value\n\nconst result = await myUsersCollection.insertOne({ name: 'Sanjar', country: 'IN' });\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},".toArray()")," is important (FIXME: but why?)"),(0,r.kt)("li",{parentName:"ul"},"MongoDB adds a ",(0,r.kt)("inlineCode",{parentName:"li"},"_id")," property automatically to a new row (object). "),(0,r.kt)("li",{parentName:"ul"},"A problem with ",(0,r.kt)("inlineCode",{parentName:"li"},"_id"),' value is not "JSON serializable". It\'s a good idea to convert the value to a string, using ',(0,r.kt)("inlineCode",{parentName:"li"},".toString()")," before using it (on the client or server side). It must be converted back to original type for interaction with MongoDB, however. This can be done using the ",(0,r.kt)("inlineCode",{parentName:"li"},"ObjectId(_id_as_string)")," function provided by MongoDB.")),(0,r.kt)("h3",{id:"4-closing-the-connection"},"4. Closing the connection"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"client.close();\n")),(0,r.kt)("p",null,"(FIXME - is this an async operation? It doesn't matter on client side code, anyway)"),(0,r.kt)("p",null,"Note"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"mongo")," package is meant to be run only on servers, and not the browser. So use it only inside server side code - ",(0,r.kt)("inlineCode",{parentName:"li"},"getStaticProps"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"getServerSideProps"),", API routes etc.")))}d.isMDXComponent=!0}}]);