"use strict";(self.webpackChunkreactjs_notes_docu=self.webpackChunkreactjs_notes_docu||[]).push([[6635],{9613:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>h});var r=a(9496);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var l=r.createContext({}),c=function(e){var t=r.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(a),m=n,h=u["".concat(l,".").concat(m)]||u[m]||d[m]||o;return a?r.createElement(h,i(i({ref:t},p),{},{components:a})):r.createElement(h,i({ref:t},p))}));function h(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,i=new Array(o);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:n,i[1]=s;for(var c=2;c<o;c++)i[c]=a[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,a)}m.displayName="MDXCreateElement"},5949:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var r=a(1163),n=(a(9496),a(9613));const o={},i="3. How React works",s={unversionedId:"vault/React_info_and_setup/How_React_works",id:"vault/React_info_and_setup/How_React_works",title:"3. How React works",description:"Created Tuesday 08 September 2020",source:"@site/docs/vault/1_React_info_and_setup/3_How_React_works.md",sourceDirName:"vault/1_React_info_and_setup",slug:"/vault/React_info_and_setup/How_React_works",permalink:"/docs/vault/React_info_and_setup/How_React_works",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/vault/1_React_info_and_setup/3_How_React_works.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"2. Why React",permalink:"/docs/vault/React_info_and_setup/Why_React"},next:{title:"3. JSX",permalink:"/docs/vault/React_-_basics/JSX"}},l={},c=[{value:"What makes React revolutionary?",id:"what-makes-react-revolutionary",level:3},{value:"React internals - Virtual DOM and the diffing algorithm",id:"react-internals---virtual-dom-and-the-diffing-algorithm",level:3},{value:"More about the diffing algorithm",id:"more-about-the-diffing-algorithm",level:3}],p={toc:c},u="wrapper";function d(e){let{components:t,...o}=e;return(0,n.kt)(u,(0,r.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"3-how-react-works"},"3. How React works"),(0,n.kt)("p",null,"Created Tuesday 08 September 2020"),(0,n.kt)("h3",{id:"what-makes-react-revolutionary"},"What makes React revolutionary?"),(0,n.kt)("p",null,"In the context of web browsers, changing from a UI frame ",(0,n.kt)("strong",{parentName:"p"},"E")," (for existing) to a UI frame ",(0,n.kt)("strong",{parentName:"p"},"R")," (for required), i.e. E --\x3e R can be done in many ways:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Remove ",(0,n.kt)("strong",{parentName:"li"},"E")," elements from the page, then calculate and paint ",(0,n.kt)("strong",{parentName:"li"},"R"),". This is the most expensive thing, computationally. It's very easy to code."),(0,n.kt)("li",{parentName:"ol"},"Specify what changes need to be done to ",(0,n.kt)("strong",{parentName:"li"},"E"),", to make it look like ",(0,n.kt)("strong",{parentName:"li"},"R"),". The changes keep in mind similar branches of the DOM, so it's economical. This is very cumbersome to code.")),(0,n.kt)("p",null,"Assume all DOM operations, layout calculations and painting to the screen were very cheap to do. One would choose to do it by the first way, i.e. just replacing the page with the new UI. React makes this possible. Of course, it's not magical. There's something called the virtual DOM and diffing algorithm. "),(0,n.kt)("p",null,"React will change the DOM in the most optimum way, ",(0,n.kt)("em",{parentName:"p"},"practically")," possible."),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://medium.com/swlh/what-the-heck-is-repaint-and-reflow-in-the-browser-b2d0fb980c08"},"Reflow and repaint, what are they?")),(0,n.kt)("h3",{id:"react-internals---virtual-dom-and-the-diffing-algorithm"},"React internals - Virtual DOM and the diffing algorithm"),(0,n.kt)("p",null,"To go from E --\x3e R, React keeps two DOM trees in memory. These in memory DOM trees are called 'virtual DOM'. They are fast to work with, because they are not connected to the webpage. Let's call them pristine and dirty. "),(0,n.kt)("p",null,(0,n.kt)("img",{src:a(9186).Z,width:"1946",height:"1242"})),(0,n.kt)("p",null,"Pristine is a copy of the current actual DOM, and dirty is initially nothing.\nSteps React uses:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"When the next frame is specified, it creates the ",(0,n.kt)("em",{parentName:"li"},"dirty tree")," based on it."),(0,n.kt)("li",{parentName:"ol"},"The pristine and dirty trees are then compared using a diffing algorithm. This results in DOM ops that need to be done to minimally update the DOM. This is called ",(0,n.kt)("a",{parentName:"li",href:"https://reactjs.org/docs/reconciliation.html#recursing-on-children"},"reconciliation"),"."),(0,n.kt)("li",{parentName:"ol"},"These DOM ops are batched together."),(0,n.kt)("li",{parentName:"ol"},"The batched DOM ops are applied to the actual DOM."),(0,n.kt)("li",{parentName:"ol"},"Reflow and repaints are done if needed."),(0,n.kt)("li",{parentName:"ol"},"The dirty tree becomes the pristine tree. And the process is repeated.\nDone!")),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://www.pluralsight.com/guides/virtual-dom-difference-maker-react-js"},"Virtual DOM and diffing")),(0,n.kt)("h3",{id:"more-about-the-diffing-algorithm"},"More about the diffing algorithm"),(0,n.kt)("p",null,"The generic algorithm for diffing trees is O(n",(0,n.kt)("sup",null,"3"),"). But React uses a heuristic O(n) algorithm based on two assumptions:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Different components will produce different trees."),(0,n.kt)("li",{parentName:"ol"},"The developer can hint at which ",(0,n.kt)("a",{parentName:"li",href:"https://reactjs.org/docs/reconciliation.html#recursing-on-children"},(0,n.kt)("em",{parentName:"a"},"child"))," elements may be stable across different renders with a ",(0,n.kt)("a",{parentName:"li",href:"https://reactjs.org/docs/reconciliation.html#keys"},"key")," prop.")),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://reactjs.org/docs/reconciliation.html#motivation"},'"In practice, these assumptions are valid for almost all practical use cases."')),(0,n.kt)("hr",null),(0,n.kt)("p",null,"I was fuzzy on the diffing details, and more importantly if React's optimization was even possible. Turns out the abstract node comparison part of the diffing algorithm is not the crux of React (it's important from a code POV though) - the major part that makes diff possible is the \"layout conscious diff\" (something skipped over by most tutorials). See ",(0,n.kt)("a",{target:"_blank",href:a(1328).Z},"ChatGPT conversation")))}d.isMDXComponent=!0},1328:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/files/React-reflow-repaint-ldiff-58cae60a7d8f29c4c9c682a9be98c531.pdf"},9186:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/3_How_React_works-image-1-ca3aa90ee09e978f5262773bb8ed1321.png"}}]);